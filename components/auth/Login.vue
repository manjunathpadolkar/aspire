<template>
  <div>
    <div class="w-screen h-screen flex justify-center items-center bg-white">
      <form
        class="p-10 bg-white rounded-lg flex justify-center items-center flex-col shadow-lg border border-grey-100"
      >
        <div class="mb-8 mt-4">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="140"
            height="40"
            viewBox="0 0 125 35"
          >
            <defs></defs>
            <g transform="translate(0.45 0.408)">
              <g transform="translate(-0.45 -0.408)">
                <path
                  class="aspire-logo"
                  d="M17.845,35q-.133,0-.266,0a17.655,17.655,0,0,1-6.7-1.328A17.289,17.289,0,0,1,5.23,29.922a.291.291,0,0,1-.118-.191.312.312,0,0,1,.118-.207c.091-.089,2.452-2.583,5.185-5.471l.012-.013.019-.021c3.311-3.5,7.064-7.463,7.233-7.628a.225.225,0,0,1,.14-.074c.04,0,.064.027.064.074.089.108,12.079,12.991,12.45,13.231.055.054.077.1.063.141s-.073.059-.165.059a13.867,13.867,0,0,1-2.245,1.89A17.326,17.326,0,0,1,19.212,34.9,9.084,9.084,0,0,1,17.845,35Zm57.8-4.183H72.988c-.2,0-.2-.1-.2-.2v-19.8c0-.2.1-.2.2-.2h2.857c.2,0,.2.1.2.2V13.11A6.1,6.1,0,0,1,78.8,10.722a7.169,7.169,0,0,1,5.815.178A6.868,6.868,0,0,1,88.3,15.3a8.637,8.637,0,0,1-.612,6.565,6.376,6.376,0,0,1-5.1,3.481,6.72,6.72,0,0,1-1.144.1,6.652,6.652,0,0,1-2.529-.5,6.431,6.431,0,0,1-2.653-1.89.517.517,0,0,1-.1-.149.517.517,0,0,0-.1-.149v7.66C76.05,30.817,76.05,30.817,75.642,30.817ZM80.6,12.772v0A4.288,4.288,0,0,0,77.683,13.9a4.48,4.48,0,0,0-1.634,3.681,5.535,5.535,0,0,1,.2.994,4.588,4.588,0,0,0,4.491,3.979H80.8a4.539,4.539,0,0,0,4.229-2.786,4.88,4.88,0,0,0,.2-3.183,4.52,4.52,0,0,0-2.959-3.481,4.306,4.306,0,0,0-1.674-.336ZM63.4,25.688a9.524,9.524,0,0,1-5.613-1.835.283.283,0,0,1-.155-.164.439.439,0,0,1,.053-.333,6.851,6.851,0,0,0,.556-1.059,9.923,9.923,0,0,1,.464-.931,8.4,8.4,0,0,1,1.162.467,12.059,12.059,0,0,0,1.287.529,6.213,6.213,0,0,0,3.265.4,3.038,3.038,0,0,0,1.02-.3,1.429,1.429,0,0,0,.811-1.041,1.4,1.4,0,0,0-.4-1.246,2.436,2.436,0,0,0-1.122-.6,14.68,14.68,0,0,0-1.643-.57c-.354-.107-.687-.208-1.01-.326l-1.53-.6a3.936,3.936,0,0,1,.2-7.162,8.824,8.824,0,0,1,3.228-.608c.148,0,.3,0,.445.011A11.47,11.47,0,0,1,68.8,11.518c.252.1.378.147.407.231s-.048.213-.2.465l-.918,1.791a.667.667,0,0,0-.056.063c-.036.045-.062.077-.116.077a.326.326,0,0,1-.134-.041,9.288,9.288,0,0,0-3.979-1.194,2.732,2.732,0,0,0-1.532.2,1.3,1.3,0,0,0-.918,1.093,1.129,1.129,0,0,0,.612,1.293,8.109,8.109,0,0,0,2.143.9,13.1,13.1,0,0,1,2.551.9,5.662,5.662,0,0,1,1.428.9,3.77,3.77,0,0,1,1.326,3.481,3.982,3.982,0,0,1-2.856,3.483A9.5,9.5,0,0,1,63.4,25.688Zm-16.643-.271a6.025,6.025,0,0,1-2.338-.469,4.57,4.57,0,0,1-2.658-2.6,4.407,4.407,0,0,1,.208-3.666,4.353,4.353,0,0,1,2.857-2.089,9.534,9.534,0,0,1,2.347-.3h4.387c.122,0,.215-.037.239-.093a.1.1,0,0,0-.035-.106,3.571,3.571,0,0,0-.1-1.093,2.586,2.586,0,0,0-2.245-1.89,7.057,7.057,0,0,0-4.285.5,5.8,5.8,0,0,0-1.326.8.189.189,0,0,1-.127.065c-.064,0-.122-.054-.179-.164a18.589,18.589,0,0,1-1.123-1.891c-.054-.053-.077-.1-.063-.139s.073-.059.165-.059a12.006,12.006,0,0,1,6.4-1.837c.349,0,.7.015,1.051.046a5.737,5.737,0,0,1,2.244.6A4.96,4.96,0,0,1,55.029,14.9a26.217,26.217,0,0,1,.1,2.886v7.362c0,.2-.1.2-.2.2H52.171c-.2,0-.2-.1-.2-.2V23.556a8.449,8.449,0,0,1-4.285,1.789A6.089,6.089,0,0,1,46.754,25.416Zm.724-6.736a7.07,7.07,0,0,0-1.939.3,1.686,1.686,0,0,0-1.122,1.194,2.22,2.22,0,0,0,1.632,2.586,4.745,4.745,0,0,0,3.675-.4,2.822,2.822,0,0,0,1.836-2.886,1.709,1.709,0,0,0,.1-.6c0-.2-.1-.2-.2-.2Zm70.361,6.7a9.277,9.277,0,0,1-3.114-.536,6.622,6.622,0,0,1-4.489-5.373,7.328,7.328,0,0,1,.51-4.675,7.041,7.041,0,0,1,5.509-4.177,10.1,10.1,0,0,1,3.877.1,5.639,5.639,0,0,1,4.389,4.078,10.17,10.17,0,0,1,.408,4.278c0,.2-.1.2-.2.2h-5.511a34.077,34.077,0,0,0-4.589-.311c-.3,0-.615,0-.92.012a.249.249,0,0,0-.225.086.215.215,0,0,0,.021.212,4.662,4.662,0,0,0,4.558,3.482h.034q.1,0,.191,0a5.735,5.735,0,0,0,3.993-1.595.2.2,0,0,1,.153-.073.194.194,0,0,1,.153.073c.254.248.487.5.713.744s.461.5.717.748a.188.188,0,0,1,.075.149.192.192,0,0,1-.075.15,9.033,9.033,0,0,1-4.083,2.188A9.33,9.33,0,0,1,117.839,25.384Zm-.122-12.545a4.3,4.3,0,0,0-2.515.8,4.138,4.138,0,0,0-1.7,2.85c-.04.076-.05.125-.032.154s.114.044.236.044h8.163c.2,0,.2-.1.2-.2a4.665,4.665,0,0,0-.714-2.089A3.849,3.849,0,0,0,118.5,12.91,4.366,4.366,0,0,0,117.717,12.839ZM95.164,25.248l-.032,0H92.377c-.2,0-.2,0-.2-.2V10.722c0-.2.1-.2.2-.2h2.755c.2,0,.2.1.2.2l.1,14.226a.266.266,0,0,1-.078.222A.279.279,0,0,1,95.164,25.248Zm8.371-.2-.034,0h-2.755c-.2,0-.2-.1-.2-.2V10.522c0-.2.1-.2.2-.2H103.6c.2,0,.2.1.2.2v2.387a5.694,5.694,0,0,1,.408-.5,5.61,5.61,0,0,1,3.979-2.088.906.906,0,0,0,.218-.041,1.06,1.06,0,0,1,.266-.048.313.313,0,0,1,.23.089.457.457,0,0,1,.115.447,1.189,1.189,0,0,0-.013.15v2.088c0,.2-.1.2-.2.2-.126-.009-.254-.014-.38-.014a5.02,5.02,0,0,0-2.58.71,4.077,4.077,0,0,0-2.04,3.582c-.068,1.662-.045,3.3-.023,4.881.011.785.023,1.59.023,2.38a.268.268,0,0,1-.08.222A.278.278,0,0,1,103.535,25.049ZM34.722,22.261h0a.223.223,0,0,1-.2-.2c-.078-.1-15.612-16.741-16.531-17.509-.13-.126-.222-.18-.307-.18-.12,0-.228.105-.407.279C17.136,4.787,1.046,21.864.843,22.162a.192.192,0,0,1-.119.065.067.067,0,0,1-.061-.039.264.264,0,0,1-.024-.126,16.383,16.383,0,0,1-.612-5.472A15.577,15.577,0,0,1,2.271,9.03,16.916,16.916,0,0,1,13.9.475,17.591,17.591,0,0,1,17.963,0,17.413,17.413,0,0,1,30.538,5.35a16.424,16.424,0,0,1,4.8,9.351,13.208,13.208,0,0,1,.2,2.884,22.708,22.708,0,0,1-.714,4.477C34.824,22.165,34.824,22.261,34.722,22.261ZM93.745,8.036A1.891,1.891,0,0,1,92.416,7.5a1.811,1.811,0,0,1-.549-1.354,2.01,2.01,0,0,1,1.939-1.989h.038a1.932,1.932,0,0,1,1.379.578,1.84,1.84,0,0,1,.52,1.411,1.879,1.879,0,0,1-.567,1.336,1.983,1.983,0,0,1-1.371.553Z"
                />
              </g>
            </g>
          </svg>
        </div>
        <div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6"
            viewBox="0 0 24 24"
          >
            <g transform="translate(-2 4)">
              <rect
                class="login-pg-logo-a"
                width="24"
                height="24"
                transform="translate(2 -4)"
              />
              <g transform="translate(4 -4)">
                <path
                  class="login-pg-logo-b"
                  d="M92.817,11.547a5.6,5.6,0,0,0,4.091-1.691A5.58,5.58,0,0,0,98.6,5.773a5.581,5.581,0,0,0-1.7-4.082,5.793,5.793,0,0,0-8.181,0,5.581,5.581,0,0,0-1.7,4.082,5.58,5.58,0,0,0,1.7,4.082A5.605,5.605,0,0,0,92.817,11.547Zm0,0"
                  transform="translate(-82.957)"
                />
                <path
                  class="login-pg-logo-b"
                  d="M19.975,254.17a14.244,14.244,0,0,0-.194-1.515,11.921,11.921,0,0,0-.373-1.523,7.517,7.517,0,0,0-.627-1.42,5.36,5.36,0,0,0-.945-1.23,4.168,4.168,0,0,0-1.358-.852,4.7,4.7,0,0,0-1.733-.313,1.76,1.76,0,0,0-.94.4c-.282.183-.611.4-.979.63a5.612,5.612,0,0,1-1.266.557,4.923,4.923,0,0,1-3.1,0,5.6,5.6,0,0,1-1.265-.557c-.364-.232-.694-.445-.98-.631a1.758,1.758,0,0,0-.939-.4,4.691,4.691,0,0,0-1.733.314,4.165,4.165,0,0,0-1.358.852,5.361,5.361,0,0,0-.945,1.23,7.532,7.532,0,0,0-.627,1.42,11.949,11.949,0,0,0-.373,1.523,14.193,14.193,0,0,0-.194,1.515c-.032.459-.048.935-.048,1.416A3.978,3.978,0,0,0,1.184,258.6a4.264,4.264,0,0,0,3.05,1.111H15.79a4.263,4.263,0,0,0,3.05-1.111,3.976,3.976,0,0,0,1.184-3.012C20.023,255.1,20.007,254.626,19.975,254.17Zm0,0"
                  transform="translate(0 -235.708)"
                />
              </g>
            </g>
          </svg>
        </div>
        <p
          class="mb-2 mt-2 text-lg uppercase text-ap-color-#0C365A open-sans tracking-wide text-bold"
        >
          Login
        </p>


        <input 
          v-model="username"
          type="email" 
          name="email" 
          class="mt-5 mb-5 p-3 w-80 focus:border-ap-color-#01D167 border-b-2 outline-none" 
          autocomplete="off" 
          placeholder="Email" 
          required
        />
        <div 
          v-if="validation.hasError('username')" 
          class="block w-full text-left"
          :class="{ 'text-red-700': true }"
        >
          {{ validation.firstError('username') }}
        </div>

        <input 
          v-model="password"
          type="password"
          name="password"
          class="mt-5 mb-5 p-3 w-80 focus:border-ap-color-#01D167 border-b-2 outline-none" 
          autocomplete="off" 
          placeholder="Password" 
          required
        />
        <div 
          v-if="validation.hasError('password')" 
          class="block w-full text-left"
          :class="{ 'text-red-700': true }"
        >
          {{ validation.firstError('password') }}
        </div>

        <div 
          v-if="errorMessage.trim().length" 
          class="block w-full text-left open-sans"
          :class="{ 'text-red-700': true }"
        >
          {{ errorMessage }}
        </div>
        <button
          class="bg-ap-color-#01D167 text-white font-bold p-3 rounded-full w-full text-ap-font-size-19 mt-10 tracking-wide open-sans"
          id="login"
          type="submit"
          @click.prevent="login"
        >
          {{ authenticating ? 'Authenticating.. ' : 'Login' }} 
        </button>
        <NuxtLink to="/signup" class="text-ap-color-#01D167 text-sm mt-4 mb-4 open-sans"
          >Don't have account? signup here.</NuxtLink
        >
      </form>
    </div>
  </div>
</template>
<script>
import _ from 'lodash'
//import Vue from 'vue'
import SimpleVueValidation from 'simple-vue-validator'
const Validator = SimpleVueValidation.Validator
//Vue.use(SimpleVueValidation)

export default {
  layout: "blank",
  data(){
    return {
      authenticating: false,
      username: '',
      password: '',
      errorMessage: ''
    }
  },
  validators: {
    username: function (value) {
      return Validator.value(value).required().email();
    },
    password: function (value) {
      return Validator.value(value).required();
    }
  },
  mounted(){
    //
  },
  methods: {
    login(){

      let _this = this

      this.$validate().then(function(success){
        if (success) {
          _this.authenticating = true
          setTimeout(function(){

            let authUser = _this.$store.state.users.find(function(value, index, arr){
              return (_this.username == value.username && _this.password == value.password) ? true : false
            })

            if(_.isObject(authUser) && _.has(authUser, 'username')){
              _this.$store.commit('setAuthUser', authUser)
              _this.$router.push('/vue-challenge')
            }
            else{
              _this.showErrorMessage('Invalid username or password')
            }

            _this.authenticating = false

          }, 2000)
        }
      })
    },
    showErrorMessage(msg){
      let _this = this
      _this.errorMessage = msg
      setTimeout(function(){
        _this.errorMessage = ''
      }, 3000)
    }
  }
}
</script>
